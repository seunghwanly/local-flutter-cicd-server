# κ²©λ¦¬ ν™κ²½ μµμ ν™” λ…ΈνΈ

## π― μ κ±°λ λ¶ν•„μ”ν• μ‘μ—…

### 1. `flutter clean` μ κ±° β…

**μ„μΉ:** `action/common/0_setup_isolated.sh`

**μ΄μ „:**
```bash
fvm flutter clean
fvm exec melos run pub
```

**ν„μ¬:**
```bash
# Note: flutter cleanμ€ λ¶ν•„μ” (κ²©λ¦¬λ ν™κ²½ + git clean -fdxλ΅ μ΄λ―Έ κΉ¨λ—ν•¨)
fvm exec melos run pub
```

**μ΄μ :**

1. **κ²©λ¦¬λ ν™κ²½**: κ° λΉλ“λ” λ…λ¦½λ λ””λ ‰ν† λ¦¬ μ‚¬μ©
   ```
   ~/ci-cd-workspace/builds/build-1/repo/  # μ™„μ „ν λ…λ¦½
   ~/ci-cd-workspace/builds/build-2/repo/  # μ™„μ „ν λ…λ¦½
   ```

2. **Git Clean**: μ΄λ―Έ `git clean -fdx`λ΅ μ •λ¦¬λ¨
   ```bash
   git reset --hard "origin/$BRANCH_NAME"
   git clean -fdx  # λ¨λ“  untracked νμΌ μ κ±°
   ```

3. **μ²« λΉλ“**: μ²« cloneμ΄λ©΄ μ• μ΄μ— κΉ¨λ—ν• μƒνƒ

---

## β΅ μ„±λ¥ κ°μ„  ν¨κ³Ό

### flutter clean μ κ±°λ΅ μΈν• μ΄μ 

**μ‹κ°„ μ μ•½:**
- `flutter clean`: ν‰κ·  5-15μ΄
- λ€κ·λ¨ ν”„λ΅μ νΈ: μµλ€ 30μ΄

**λ””μ¤ν¬ I/O κ°μ†:**
- build/ λ””λ ‰ν† λ¦¬ μ‚­μ /μ¬μƒμ„± λ¶ν•„μ”
- .dart_tool/ μ¬μƒμ„± λ¶ν•„μ”

**μμƒ κ°μ„ :**
- ν‰κ·  λΉλ“ μ‹κ°„: **5-15μ΄ λ‹¨μ¶•**
- λ””μ¤ν¬ μ“°κΈ° μ‘μ—…: **~500MB κ°μ†** (ν”„λ΅μ νΈ ν¬κΈ°μ— λ”°λΌ)

---

## π” μ—¬μ „ν ν•„μ”ν• Clean μ‘μ—…

### Git Clean (μ μ§€)

```bash
git reset --hard "origin/$BRANCH_NAME"
git clean -fdx
```

**μ΄μ :**
- μ΄μ „ λΉλ“ μ‹¤ν¨λ΅ μΈν• μ”μ—¬ νμΌ μ κ±°
- Git tracked μƒνƒλ¥Ό μ›κ²©κ³Ό λ™κΈ°ν™”
- λ΅μ»¬ μμ •μ‚¬ν•­ μ™„μ „ μ κ±°

### μ„ νƒμ  Clean (μƒν™©μ— λ”°λΌ)

**μ–Έμ  cleanμ΄ ν•„μ”ν•κ°€?**

1. **λ κ±°μ‹ μ¤ν¬λ¦½νΈ (`action/{flavor}/0_setup.sh`)**
   - κ³µμ  λ””λ ‰ν† λ¦¬λ¥Ό μ‚¬μ©ν•λ” κ²½μ°
   - μ—¬λ¬ λΉλ“κ°€ λ™μΌν• μ›ν‚Ή λ””λ ‰ν† λ¦¬ μ¬μ‚¬μ©
   - β†’ `flutter clean` μ μ§€ ν•„μ”

2. **λ΅μ»¬ κ°λ° ν™κ²½**
   - κ°λ°μκ°€ μλ™μΌλ΅ λΉλ“ν•λ” κ²½μ°
   - β†’ `flutter clean` μλ™ μ‹¤ν–‰

3. **κ²©λ¦¬ ν™κ²½ (`action/common/*_isolated.sh`)**
   - μ™„μ „ν λ…λ¦½λ λ””λ ‰ν† λ¦¬
   - β†’ `flutter clean` λ¶ν•„μ” β…

---

## π“ λΉ„κµν‘

| ν™κ²½ | λ””λ ‰ν† λ¦¬ | flutter clean | git clean | μ΄μ  |
|------|---------|---------------|-----------|------|
| **λ κ±°μ‹ (κ³µμ )** | `~/src/dev/project` | β… ν•„μ” | β… ν•„μ” | λ™μΌ λ””λ ‰ν† λ¦¬ μ¬μ‚¬μ© |
| **κ²©λ¦¬ (μƒλ΅μ΄)** | `~/ci-cd-workspace/builds/{id}/repo` | β λ¶ν•„μ” | β… ν•„μ” | λ…λ¦½ λ””λ ‰ν† λ¦¬ + git μ •λ¦¬λ§ |
| **λ΅μ»¬ κ°λ°** | κ°λ°μ λ΅μ»¬ | β… μλ™ | β… μλ™ | ν•„μ”μ‹λ§ μ‹¤ν–‰ |

---

## π€ μ¶”κ°€ μµμ ν™” κ°€λ¥μ„±

### 1. Git Clone μµμ ν™”

**ν„μ¬:**
```bash
git clone "$REPO_URL" "$LOCAL_DIR"
```

**κ°μ„ μ•:**
```bash
# Shallow clone (νμ¤ν† λ¦¬ μµμ†ν™”)
git clone --depth 1 --single-branch --branch "$BRANCH_NAME" "$REPO_URL" "$LOCAL_DIR"
```

**ν¨κ³Ό:**
- ν΄λ΅  μ‹κ°„: 30-50% λ‹¨μ¶•
- λ””μ¤ν¬ μ‚¬μ©λ‰: 50-70% κ°μ†

**μ£Όμμ‚¬ν•­:**
- Git νμ¤ν† λ¦¬κ°€ ν•„μ”ν• μ‘μ—… (git log, blame λ“±) μ ν•λ  μ μμ

### 2. Melos Bootstrap μΊμ‹±

**ν„μ¬:**
```bash
fvm exec melos run pub  # λ§¤λ² λ¨λ“  ν¨ν‚¤μ§€ λ‹¤μ΄λ΅λ“
```

**κ°μ„ μ•:**
```bash
# PUB_CACHEκ°€ μ΄λ―Έ κ²©λ¦¬λμ–΄ μμΌλ―€λ΅, 
# λ™μΌ λΈλμΉμ μ¬λΉλ“ μ‹ μΊμ‹ ν™μ© κ°€λ¥
```

**κµ¬ν„:**
- λ™μΌ (branch, fvm_flavor, flavor)λ” μμ°¨ μ‹¤ν–‰λλ―€λ΅
- μ΄μ „ λΉλ“μ PUB_CACHEλ¥Ό μ¬μ‚¬μ©ν•  μ μμ

### 3. Gradle μΊμ‹ κ³µμ 

**ν„μ¬:**
```bash
GRADLE_USER_HOME=$BUILD_DIR/gradle_home  # λΉλ“λ³„ λ…λ¦½
```

**κ°μ„ μ•:**
```bash
# λ™μΌ ν”„λ΅μ νΈμ λ¨λ“  λΉλ“κ°€ Gradle μΊμ‹ κ³µμ 
GRADLE_USER_HOME=~/ci-cd-workspace/shared/gradle
```

**ν¨κ³Ό:**
- Android λΉλ“ μ‹κ°„: 20-40% λ‹¨μ¶•
- λ””μ¤ν¬ μ‚¬μ©λ‰: κ°μ†

**μ£Όμμ‚¬ν•­:**
- μ„λ΅ λ‹¤λ¥Έ Gradle λ²„μ „ κ°„ μ¶©λ κ°€λ¥μ„±

---

## π“ κ¶μ¥μ‚¬ν•­

### μ¦‰μ‹ μ μ© (μ™„λ£) β…

- [x] `flutter clean` μ κ±° (κ²©λ¦¬ μ¤ν¬λ¦½νΈ)
- [x] μ£Όμ„ μ¶”κ°€ (μ΄μ  λ…μ‹)

### μ¶”κ°€ κ²€ν†  (μ„ νƒμ‚¬ν•­)

- [ ] Git shallow clone μ μ©
- [ ] PUB_CACHE μ¬μ‚¬μ© μ „λµ
- [ ] Gradle μΊμ‹ κ³µμ  μ „λµ

### μ μ§€ν•΄μ•Ό ν•  κ²ƒ

- [x] `git clean -fdx` (Git μƒνƒ μ •λ¦¬)
- [x] λ κ±°μ‹ μ¤ν¬λ¦½νΈμ `flutter clean` (κ³µμ  λ””λ ‰ν† λ¦¬)

---

**μ‘μ„±μΌ:** 2025-10-02  
**λ²„μ „:** 1.0

